/**
 * Script to add AI Interview Analysis examples
 * This demonstrates how the AI analysis feature works with transcripts and guide questions
 */

const sampleTranscript = `SPEAKER_00: Здравствуйте, Иван. Спасибо, что согласились на интервью. Расскажите, как ваша компания сейчас обменивает валюту?

SPEAKER_01: Здравствуйте! В основном мы работаем через наш банк. У нас есть мультивалютные счета, и когда нужно обменять - звоним менеджеру или идем в отделение.

SPEAKER_00: Какие сложности вы испытываете при текущем процессе обмена валюты?

SPEAKER_01: Главная проблема - это время. Когда курс меняется быстро, мы не всегда успеваем зафиксировать выгодный курс. Приходится звонить, ждать подтверждения... Иногда теряем на этом деньги.

SPEAKER_00: А как часто вам приходится обменивать валюту?

SPEAKER_01: Примерно 3-4 раза в неделю. У нас импортные поставки, платим в долларах и евро, а выручка в основном в рублях.

SPEAKER_00: Если бы было мобильное приложение для обмена валюты, какие функции были бы для вас критически важны?

SPEAKER_01: Во-первых, скорость. Чтобы в пару кликов можно было обменять по текущему курсу. Во-вторых, уведомления о достижении нужного курса. И обязательно история операций с понятной аналитикой - сколько потратили на комиссиях, какой средний курс обмена.

SPEAKER_00: Расскажите подробнее про уведомления. Как это должно работать?

SPEAKER_01: Я бы хотел ставить целевые курсы. Например, "хочу купить доллары не дороже 95 рублей". И когда курс достигает этого значения - приложение присылает push-уведомление. Можно даже настроить автоматический обмен при достижении курса.

SPEAKER_00: Это интересно. А какие опасения у вас есть по поводу безопасности таких операций?

SPEAKER_01: Конечно, безопасность очень важна. Нужна хорошая двухфакторная аутентификация, подтверждение крупных операций через SMS. И чтобы было видно все детали транзакции перед подтверждением - сумма, курс, комиссия.

SPEAKER_00: Сколько вы готовы платить за такой сервис?

SPEAKER_01: Если комиссия будет ниже чем в банке и курс конкурентный - готовы платить даже небольшую абонентскую плату. Главное чтобы в итоге экономия была заметна. Сейчас банк берет примерно 1-1.5% комиссии.`;

const sampleAnalysisResult = {
  items: [
    {
      blockName: "Введение (5 минут)",
      blockSummary: "Респондент активно использует валютные операции в бизнесе (3-4 раза в неделю), работает с мультивалютными счетами через традиционный банк. Текущий процесс требует личного контакта с банком (звонок или визит в отделение), что создает барьеры для быстрого реагирования на изменения курса.",
      blockElements: [
        {
          question: "Как ваша компания сейчас обменивает валюту?",
          answer: "В основном мы работаем через наш банк. У нас есть мультивалютные счета, и когда нужно обменять - звоним менеджеру или идем в отделение."
        },
        {
          question: "Как часто вам приходится обменивать валюту?",
          answer: "Примерно 3-4 раза в неделю. У нас импортные поставки, платим в долларах и евро, а выручка в основном в рублях."
        }
      ]
    },
    {
      blockName: "Текущие проблемы и боли",
      blockSummary: "Критическая проблема - потеря времени при обмене валюты, особенно при волатильном курсе. Респондент несет финансовые потери из-за невозможности быстро зафиксировать выгодный курс. Процесс требует ручной коммуникации и ожидания подтверждения, что замедляет операции.",
      blockElements: [
        {
          question: "Какие сложности вы испытываете при текущем процессе обмена валюты?",
          answer: "Главная проблема - это время. Когда курс меняется быстро, мы не всегда успеваем зафиксировать выгодный курс. Приходится звонить, ждать подтверждения... Иногда теряем на этом деньги."
        }
      ]
    },
    {
      blockName: "Требования к мобильному приложению",
      blockSummary: "Ключевые требования: скорость операций (обмен в пару кликов), проактивные уведомления о достижении целевого курса, прозрачная аналитика расходов и комиссий. Респондент готов использовать автоматизацию - автоматический обмен при достижении целевого курса.",
      blockElements: [
        {
          blockName: "Критические функции",
          blockSummary: "Скорость, уведомления и аналитика определены как must-have функции для приложения.",
          blockElements: [
            {
              question: "Какие функции были бы критически важны?",
              answer: "Во-первых, скорость. Чтобы в пару кликов можно было обменять по текущему курсу. Во-вторых, уведомления о достижении нужного курса. И обязательно история операций с понятной аналитикой - сколько потратили на комиссиях, какой средний курс обмена."
            }
          ]
        },
        {
          blockName: "Умные уведомления",
          blockSummary: "Функция установки целевых курсов с автоматическими уведомлениями и возможностью автоматического обмена имеет высокую ценность.",
          blockElements: [
            {
              question: "Как должны работать уведомления?",
              answer: "Я бы хотел ставить целевые курсы. Например, 'хочу купить доллары не дороже 95 рублей'. И когда курс достигает этого значения - приложение присылает push-уведомление. Можно даже настроить автоматический обмен при достижении курса."
            }
          ]
        }
      ]
    },
    {
      blockName: "Безопасность и доверие",
      blockSummary: "Безопасность является критическим фактором принятия решения. Необходима надежная двухфакторная аутентификация, дополнительное подтверждение крупных операций через SMS, полная прозрачность операции перед подтверждением (сумма, курс, комиссия).",
      blockElements: [
        {
          question: "Какие опасения у вас есть по поводу безопасности таких операций?",
          answer: "Конечно, безопасность очень важна. Нужна хорошая двухфакторная аутентификация, подтверждение крупных операций через SMS. И чтобы было видно все детали транзакции перед подтверждением - сумма, курс, комиссия."
        }
      ]
    },
    {
      blockName: "Ценообразование и готовность платить",
      blockSummary: "Респондент готов платить за сервис, если он обеспечит экономию по сравнению с банком. Текущая банковская комиссия составляет 1-1.5% (бенчмарк для конкурентности). Готовность к абонентской плате при условии лучшего курса и низких комиссий. Ключевой фактор - итоговая экономия должна быть заметной.",
      blockElements: [
        {
          question: "Сколько вы готовы платить за такой сервис?",
          answer: "Если комиссия будет ниже чем в банке и курс конкурентный - готовы платить даже небольшую абонентскую плату. Главное чтобы в итоге экономия была заметна. Сейчас банк берет примерно 1-1.5% комиссии."
        }
      ]
    }
  ],
  summary: `**Ключевые инсайты:**

1. Целевая аудитория (SME с частыми валютными операциями) испытывает реальную боль от медленного и неудобного процесса обмена валют
2. Скорость и автоматизация - ключевые факторы успеха продукта, респонденты готовы платить за экономию времени и денег
3. Безопасность не является барьером, но требует тщательной проработки (2FA, подтверждения, прозрачность)
4. Функции умных уведомлений и автоматического обмена по целевому курсу имеют высокую ценность для пользователей
5. Существует готовность платить за сервис при условии демонстрируемой экономии относительно традиционных банков

**Рекомендации для продуктовой команды:**

1. **Приоритет #1: Скорость UX** - разработать flow обмена валют максимум в 2-3 клика от открытия приложения до завершения операции
2. **MVP Feature: Целевые курсы** - включить систему целевых курсов с push-уведомлениями, это killer feature для целевой аудитории
3. **Безопасность** - комплексная система безопасности с многофакторной аутентификацией и полной прозрачностью операций
4. **Ценообразование** - обеспечить комиссию существенно ниже 1% для привлечения пользователей от банков
5. **Аналитика** - добавить модуль отслеживания экономии и расходов для повышения вовлеченности и retention`
};

async function addExamples() {
  try {
    console.log('Adding AI Interview Analysis examples...\n');
    
    // First, get the existing meeting data to preserve required fields
    const getResponse = await fetch('http://localhost:5000/api/meetings/1');
    if (!getResponse.ok) {
      console.error('Failed to fetch meeting:', await getResponse.text());
      return;
    }
    
    const existingMeeting = await getResponse.json();
    
    // Build update payload with all required fields plus our new data
    const updatePayload = {
      // Required fields from existing meeting
      respondentName: existingMeeting.respondentName,
      respondentPosition: existingMeeting.respondentPosition,
      cnum: existingMeeting.cnum,
      gcc: existingMeeting.gcc,
      companyName: existingMeeting.companyName,
      email: existingMeeting.email,
      phone: existingMeeting.phone,
      researcher: existingMeeting.researcher,
      relationshipManager: existingMeeting.relationshipManager,
      salesPerson: existingMeeting.salesPerson,
      date: existingMeeting.date,
      
      // Fields we want to update
      transcript: sampleTranscript,
      summarizationStatus: 'completed',
      summarizationResult: sampleAnalysisResult
    };
    
    // Update meeting #1 with transcript and analysis
    const response = await fetch('http://localhost:5000/api/meetings/1', {
      method: 'PATCH',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(updatePayload),
    });

    if (response.ok) {
      console.log('✓ Successfully added AI analysis example to Meeting #1');
      console.log('\nTo view the example:');
      console.log('1. Navigate to Meetings page');
      console.log('2. Open meeting "Интервью с представителем малого бизнеса"');
      console.log('3. Go to the "Результаты" tab');
      console.log('\nYou will see:');
      console.log('- Structured analysis with expandable blocks for each interview section');
      console.log('- Block summaries highlighting key insights from each topic');
      console.log('- Question-answer pairs extracted from the transcript');
      console.log('- Overall summary with key insights and product recommendations');
      console.log('- Nested sub-blocks showing detailed analysis (e.g., "Критические функции", "Умные уведомления")\n');
    } else {
      console.error('Failed to update meeting:', await response.text());
    }
  } catch (error) {
    console.error('Error:', error);
  }
}

addExamples();
